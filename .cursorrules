# Project Rules for AI Assistants

## Protected Files - DO NOT EDIT

The following files should NEVER be modified unless explicitly requested by the user:

- `metro.config.js`
- `babel.config.js`

## Protected Dependencies - DO NOT REMOVE

The following dependencies must NEVER be removed from package.json:

- `nativewind`
- `react-native-pager-view`

## Project Context

This is a React Native/Expo project using:

- NativeWind v4 for styling (Tailwind CSS)
- Expo Router for navigation
- Rive for animations (.riv files)
- React Native Reanimated for animations
- Zustand for state management (DO NOT use useState, use zustand stores)

## Known Platform Fixes

### Android - Regula Face SDK

Add Maven repo to `android/build.gradle` in `allprojects.repositories`:

```gradle
maven { url 'https://maven.regulaforensics.com/RegulaDocumentReader' }
```

### iOS - GoogleMLKit Version Conflict

Remove conflicting packages and keep only FaceDetection:

```bash
pnpm remove @react-native-ml-kit/text-recognition react-native-vision-camera-text-recognition
```

In `ios/Podfile`:

```ruby
$GoogleMLKitVersion = '7.0.0'
pod 'GoogleMLKit/FaceDetection', $GoogleMLKitVersion, :modular_headers => true
```

Then: `cd ios && pod install --repo-update`

### Android - TextRecognition Import Error

After removing text-recognition package, fix imports in `components/verification/tabs/IdScanTab.tsx`.

### Android - Metro Bundler Cache

If changes not reflected:

```bash
lsof -ti:8081 | xargs kill -9
npx expo start --clear --android
```

### Native Rebuild

After adding native dependencies: `npx expo run:android` or `npx expo run:ios`

## Code Style

- Use TypeScript
- Follow existing code patterns
- Do not add or remove comments unless asked
- Preserve existing formatting

## Production-First Development

**⚠️ ALWAYS write code for production and ALWAYS push changes.**

**CRITICAL RULES:**
1. **ALWAYS push code after making changes** - Never leave code uncommitted or unpushed. After completing any task:
   ```bash
   git add -A
   git commit -m "Descriptive commit message"
   git push origin main
   ```

2. **ALWAYS publish to production after pushing** - After pushing code, immediately publish an EAS update to production:
   ```bash
   eas update --channel production --message "Description of changes"
   ```

3. **Code for production from the start** - Write all code assuming it will run in production:
   - Use production API URLs (`EXPO_PUBLIC_API_URL`, `EXPO_PUBLIC_AUTH_URL`)
   - Include error handling for network failures
   - Add loading states and fallbacks
   - Never rely on dev server features

4. **Workflow checklist:**
   - ✅ Write code with production in mind
   - ✅ Test locally if possible
   - ✅ Commit changes with descriptive message
   - ✅ Push to `main` branch
   - ✅ Publish EAS update to production channel
   - ✅ Verify update appears in EAS dashboard
